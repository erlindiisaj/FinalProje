---
title: 'Proje Rapor : Erlindi Isaj 200401114'
output:
  html_document:
    df_print: paged
---
# Q1 : Problem tanımı

Uygun fiyat bulma konusundaki sorunları çözmek, işletme performansını artırmak ve müşteri memnuniyetini güçlendirmek için önemlidir. Bu problemin başa çıkmak için alınabilecek bazı genel stratejiler ihtiyacımız var. Kullanılmış araba fiyatları, aracın değer kaybı, bakım geçmişi ve genel mekanik durumu gibi etkenlerle belirlenir. Piyasadaki arz ve talep de kullanılmış araba fiyatlarını etkileyen önemli faktörler arasındadır. Bu nedenle, bir aracın fiyatını belirlemek için dikkatlice değerlendirme yapmak önemlidir.

# Q2 : Proje amacı

Projenin temel amacı, araç fiyatlarını öngörebilen bir model geliştirmek için veri analizi ve doğrusal regresyon yöntemlerini kullanmaktır. Bu kapsamlı proje, veri bilimi, istatistik ve makine öğrenmesi alanlarındaki temel konseptleri uygulamak amacıyla tasarlanmıştır.

Projede kullanılacak veri seti, çeşitli araç modelleri ve bu modellerin özellikleriyle ilişkilendirilmiş fiyat bilgilerini içermektedir. Veri setinin temizlenmesi, eksik verilerin işlenmesi ve sayısal özelliklerin standartlaştırılması gibi veri ön işleme adımları gerçekleştirilecek. Ardından, veri seti üzerinde keşifsel veri analizi yapılacak.

Araç fiyatlarını etkileyen faktörleri belirleyip, bu faktörlerin modelleme için uygun hale getirilmesi sağlanacaktır. Doğrusal regresyon modeli, seçilen özelliklerle araç fiyatlarını en iyi şekilde açıklayabilecek bir matematiksel ilişkiyi tanımlamak üzere eğitilecektir. Modelin performansı, test veri kümesi üzerinde değerlendirilecek ve bu değerlendirme sonuçlarına dayanarak modelin ayarlamaları yapılacaktır. Ayrıca, modelin sunduğu katsayılar ve diğer çıktılar analiz edilerek, araç fiyatlarını etkileyen faktörlerin anlamı üzerine derinlemesine bir anlayış elde edilecektir.

# Q3 : Veri seti keşifsel analizi

```{r echo=FALSE, message=FALSE, warning=FALSE}
filename <- "car data.csv"
data <- read.csv(filename)

summary(data)
```


Dataset, 301 satır ve 9 sütunu içeriyor. Her satır, bir araç hakkında bilgi içeriyor. Amacımız, "Selling_Price" sütunundaki değeri diğer sütunlardaki bilgileri kullanarak tahmin etmektir.

Her sütunun veri türünü kontrol edelim:
```{r echo=FALSE, message=FALSE, warning=FALSE}
str(data)
```

Year, Selling_Price, Current_Price, owner ve kms_driven bilgisi numeric verilerdir, ancak Car_Name, Fuel_Type, Seller_Type ve Transmission character verilerdir.

Sayısal sütunlar mantıklı görünüyor, herhangi bir sütunda anormallik bulunmuyor. Sadece selling_price ve current_price gibi görünüyor ki gerçek araba fiyatlarının kodlamasıdır. Ancak, bu, değerlerin her zaman veri sağlayıcıdan gerçek değerlerine çevrilebileceği için analizimizi etkilemeyecek. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
hist(data$Year, 
     main = "Yılın dağılımı", 
     xlab = "Yıl",            
     ylab = "Sayı",         
     col = "skyblue",             
     border = "black", 
     xlim= c(2000, 2020),
     breaks = 15,  

)
```



Yıl sütunu numeric bir sütun olduğundan, maksimum değerin 2018 ve minimum değerin 2003 olduğunu görebiliriz. Histogram kullanarak araç sayısının, yıl daha yeni olduğunda artırılmasını görebiliriz.


```{r echo=FALSE, message=FALSE, warning=FALSE}
plot(data$Year, data$Selling_Price, 
     main = "Year and Selling_price", 
     xlab = "Year", 
     ylab = "Selling Price", 
     pch = 16, 
     col = "blue"
)
```



Bu grafikten, yıl ne kadar yeni ise fiyatın o kadar yüksek olduğunu söyleyebiliriz. Bu bağlantıyı, fiyat tahminimize yardımcı olmak için daha sonra kullanabiliriz.




# Q4 : Veri seti ön işlemesi 

 Fuel_Type sütunu *character* tipinden  *factor* tipine dönüştürülmüştür.
```{r echo=FALSE, message=FALSE, warning=FALSE}
data$Fuel_Type <- as.factor(data$Fuel_Type)
```

 Seller_type sütunu *character* tipinden  *factor* tipine dönüştürülmüştür.
```{r echo=FALSE, message=FALSE, warning=FALSE}
data$Seller_Type <- as.factor(data$Seller_Type)
```

 Transmission sütunu *character* tipinden  *factor* tipine dönüştürülmüştür.
```{r echo=FALSE, message=FALSE, warning=FALSE}
data$Transmission <- as.factor(data$Transmission)
```

 Verileri *numeric* tipine dönüştürülmüştür.
```{r echo=FALSE, message=FALSE, warning=FALSE}
data$Year <- as.numeric(data$Year)
data$Kms_Driven <- as.numeric(data$Kms_Driven)
data$Owner <- as.numeric(data$Owner)
data$Fuel_Type <- as.numeric(data$Fuel_Type)
data$Seller_Type <- as.numeric(data$Seller_Type)
data$Transmission <- as.numeric(data$Transmission)
```
 'Car_name' sütununu faktörlere dönüştürmek istersek, seviye sayısı çok yüksek olabilir, bu nedenle bu sütun veri setinde gerekli değildir.

```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- data[, -which(names(data) == "Car_Name")]
```
Üzerinde çalışılacak olan sütunlarda, NA değerlerinin temizlenmesi gerek yok.



# Q5 : Veri mühendisliği

Daha önce gördüğümüz gibi bazı sütunlar diğerlerine göre satış fiyatı ile daha yakından ilişkilidir. Mesela "Selling_Price" ve "Present_Price" sütunlarının birbirleriyle ilişkili olup olmadığını kontrol edelim:
```{r echo=FALSE, message=FALSE, warning=FALSE}
plot(data$Present_Price, data$Selling_Price, 
     main = "Present_price and Selling_price", 
     xlab = "Present Price", 
     ylab = "Selling Price", 
     pch = 16, 
     col = "blue"
)
```




Görüldüğü gibi, mevcut fiyat ne kadar yüksekse, satış fiyatı da o kadar yüksek. Böylece bu ilişki, correlation coefficient adı verilen bir ölçü kullanılarak sayısal olarak ifade edilebilir. Correlation coefficient, iki değişken arasındaki doğrusal ilişkinin gücünü ve yönünü ölçen istatistiksel bir ölçüdür ve -1 ile 1 arasında bir değere sahiptir. 1 korelasyon katsayısı, mükemmel bir pozitif doğrusal ilişkiyi gösterir, yani bir değişken arttığında, diğer değişken de orantılı olarak artar. -1 korelasyon katsayısı, mükemmel bir negatif doğrusal ilişkiyi gösterir, yani bir değişken arttığında, diğer değişken orantılı olarak azalır. 0 korelasyon katsayısı, iki değişken arasında doğrusal bir ilişki olmadığını gösterir.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
correlation_data <- cor(data)
ggplot(as.data.frame(as.table(correlation_data)), aes(x = Var1, y = Var2, fill = Freq)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "white", high = "#ff1a00") +
  theme_minimal()
```



Correlation Heatmap'ten "Present Price" (Aracın yeni satın alındığı fiyat) ve "Selling Price" (Satış Fiyatı) yüksek correlation değerlerine sahiptir. Bu özellik olan "Present Price"ı kullanarak hedef çıktımız olan "Selling_price"ı tahmin edebiliriz.



# Q6 : Veri analizi

2D grafiğinde bu noktalara uyacak bir çizgi oluşturmaktır. Burada x özelliğimizi (Present Price) temsil eder ve y'yi (Selling Price) tahmin etmektir. 2D (X ve Y) koordinatlardaki bir çizginin formülü şu şekildedir:

y = w * x + b

Eğer yukarıdaki formülde Selling Price ve Present Price yerine koyarsak, şu şekilde görünecektir:

selling_price = w * present_price + b

Amacımız, w ve b parametrelerinin değerlerini bulmaktır ki bu değerler, verilere en iyi uyan bir çizgi oluştursun. Bu kullandığımız yönteme lineer regresyon denir, buradaki denklem lineer regresyon modeli olarak bilinir. Çünkü "Present Price" ve "Selling Price" arasındaki korelasyonu bir doğru çizgide formüle eder. 'w' ve 'b' genellikle model parametreleri veya ağırlıkları olarak bilinir.

Lineer regresyon kullanırken, verilerinizi train ve test kümelerine ayırmak yaygın bir uygulamadır. Bu, modelinizi verilerin bir alt kümesinde train ve ardından hiç görmediği başka bir alt kümede performansını değerlendirmenize olanak tanır. Bu, modelinizin yeni, görülmemiş verilere ne kadar iyi genelleme yaptığını değerlendirmenize yardımcı olur.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(caret)
set.seed(123)
splitIndex <- createDataPartition(data$Selling_Price, p = 0.8, list = FALSE)
trainData <- data[splitIndex, ]
testData <- data[-splitIndex, ]
```


**Train için kullanılan verileri.**
Bu, veri setinin en büyük alt kümesidir ve modelini train etmek için kullanılır. Train seti genellikle veri setinin yaklaşık olarak %80'ini kapsar.
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
as_tibble(trainData)
```





**Test için kullanılan verileri.**
Bu, modelin eğitim veya doğrulama aşamasında hiç görmediği verilerdir. Tüm train ve doğrulama işlemleri tamamlandıktan sonra modelin performansını değerlendirmek için kullanılır.
```{r echo=FALSE, message=FALSE, warning=FALSE}
as_tibble(testData)
```




Şimdi modeli oluşturalım ve oluşturulan modelin sonuçlarını kontrol etmek için test verilerini kullanalım. Bizim modelimizi değerlendirmek için MSE kullanacağız. MSE, Ortalama Kare Hatası'nın kısaltmasıdır. Bu, regresyon problemlerinde gerçek ve tahmin edilen değerler arasındaki ortalama karesel farkı ölçmek için yaygın olarak kullanılan bir metriktir. Daha düşük bir MSE, daha iyi bir model performansını gösterir, çünkü bu, tahmin edilen değerlerin gerçek değerlere daha yakın olduğu anlamına gelir.

```{r echo=FALSE, message=FALSE, warning=FALSE}


model <- lm(Selling_Price ~ Year + Present_Price + Kms_Driven + Owner + Transmission + Seller_Type + Fuel_Type , data = trainData)


predictions <- predict(model, testData)

residuals <- testData$Selling_Price - predictions
mse <- mean(residuals^2)

print(paste("Mean Squared Error:", mse))

```




```{r echo=FALSE, message=FALSE, warning=FALSE}
# Visualize predictions vs. actual values
plot(predictions, testData$Selling_Price, main = "Predictions vs. Actual Values", xlab = "Actual Values", ylab = "Predictions")
abline(a = 0, b = 1, col = "red")  # Add a diagonal line for reference
```
Grafikte gördüğü gibi Preictions ve Actual Values çok yakındır.







```{r message=FALSE, warning=FALSE, include=FALSE}
library(testthat)
path <- "q1_tests_erlindi_isaj_200401114.R"
test_file(path)
```


